@(paacForm : Form[models.CalculatorFormFields], isEdit: Boolean)(implicit request:Request[_])

@import uk.gov.hmrc.play.views.html.helpers._
@import models._

@defining(models.PensionPeriod.toPensionPeriod(paacForm.data.get("triggerDate").getOrElse("2016-01-01")).taxYear()) { taxYear =>
@defining(CalculatorFormFields(Amounts(), Amounts(), Amounts(), Year2015Amounts(
  postTriggerDcAmount2015P1=paacForm.data.get("year2015.postTriggerDcAmount2015P1").flatMap((v) =>if (v == "") None else Some(BigDecimal(v.toDouble))),
  postTriggerDcAmount2015P2=paacForm.data.get("year2015.postTriggerDcAmount2015P2").flatMap((v) =>if (v == "") None else Some(BigDecimal(v.toDouble))) ),
  paacForm.data.get("triggerAmount").flatMap((v) => if (v == "") None else Some(v.toInt)),
  paacForm.data.get("triggerDate"))){ errorModel =>
@common.paacMain(
pageTitle = Messages("paac.post.trigger.value.page.title"),
heading = if(paacForm.value.getOrElse(errorModel).triggerDatePeriod.get.isPeriod1()) 
            Messages("paac.post.trigger.value.page.question.p1") 
          else if (paacForm.value.getOrElse(errorModel).triggerDatePeriod.get.isPeriod2()) 
            Messages("paac.post.trigger.value.page.question.p2") 
          else 
            Messages("paac.post.trigger.value.page.question", ""+taxYear, ""+(taxYear+1)),
backLink = Some((controllers.routes.PostTriggerPensionInputsController.onBack.url,Messages("paac.link.text.back")))
) {
    <p id="paac.post-trigger-value.p1">
      @defining(paacForm.data("triggerDate").split("-")) { tDate =>
        @if(paacForm.value.getOrElse(errorModel).triggerDatePeriod.get.isPeriod1()) {
          @Messages("paac.post.trigger.value.description.p1", Messages("paac.review-amounts.value."+tDate(1), tDate(2).toInt.toString, tDate(0)))
        } else {
          @if(paacForm.value.getOrElse(errorModel).triggerDatePeriod.get.isPeriod2()) {
            @Messages("paac.post.trigger.value.description.p2", Messages("paac.review-amounts.value."+tDate(1), tDate(2).toInt.toString, tDate(0)))
          } else {
            @Messages("paac.post.trigger.value.description.other", Messages("paac.review-amounts.value."+tDate(1), tDate(2).toInt.toString, tDate(0)), ""+(taxYear+1))
          }
        }
      }
    </p>
    @if(paacForm.hasErrors) {
      <div class="error-summary" role="group" aria-labelledby="error-summary-heading-example-1" tabindex="-1" style="border: 5px solid #b10e1e;padding: 20px;padding-top: 0px;margin-bottom: 30px;">

        <h1 class="heading-medium error-summary-heading">
          There was a problem with the amount you reported to us
        </h1>

        @if(paacForm.hasGlobalErrors) {
          <ul>
          @for(error <- paacForm.globalErrors) {
            <li>@error.message</li>
          }
          </ul>
        }

        <ul class="error-summary-list">
          @for(error <- paacForm.errors) {
            @defining(Seq(taxYear.toString)++error.args) { args =>
            <li><a href="triggerAmountFieldset" style="color:#b10e1e;font-weight: bold;">@Messages("paac.post.trigger.value."+error.message, args:_*)</a></li>
            }
          }
        </ul>
      </div>
    }

    @form(
        action = controllers.routes.PostTriggerPensionInputsController.onSubmit,
        args = 'class -> "form", 'autocomplete -> "off", 'novalidate -> "") {
@defining(paacForm.value.getOrElse(errorModel)) { model =>
        <input type="hidden" id="triggerDate" name="triggerDate" value="@(model.triggerDate)"/>
        <input type="hidden" id="isEdit" name="isEdit" value="@isEdit"/>
        <table>
            <tbody>
              @if(model.triggerDatePeriod.get.isPeriod1()) {
                @defining("year2015.postTriggerDcAmount2015P1") { id =>
                <fieldset id="triggerAmountFieldset" class="form-field-group" style="max-width:12.35em;">
                      <span style="float:right">
                      @if(model.year2015.postTriggerDcAmount2015P1 != None) {
                        <tr style="text-align:left;min-width: 7em">
                            <p>@Messages("paac.post.trigger.amount.input.label")</p>
                            <span  class="form-hint">@Messages("paac.common.inputfield.example.message")</span>
                            &pound;&nbsp;<input type="number" name="@id" id="@id" min="0" class="input--no-spinner" value='@(model.year2015.postTriggerDcAmount2015P1.get)' max="5000000" size="7" style="width:9em;@if(paacForm.errors.find(_.key == id)) {border: 4px solid #b10e1e;}"/>
                        </tr>
                      } else {
                        <tr style="text-align:left;min-width: 7em">
                            <p>@Messages("paac.post.trigger.amount.input.label")</p>
                            <span  class="form-hint">@Messages("paac.common.inputfield.example.message")</span>
                            &pound;&nbsp;<input type="number" name="@id" id="@id" min="0" class="input--no-spinner" value='' max="5000000" size="7" style="width:9em;@if(paacForm.errors.find(_.key == id)) {border: 4px solid #b10e1e;}"/>
                        </tr>
                      }
                      </span>
                </fieldset>
                }
              }
              @if(model.triggerDatePeriod.get.isPeriod2()) {
                @defining("year2015.postTriggerDcAmount2015P2") { id =>
                <fieldset id="triggerAmountFieldset" class="form-field-group" style="max-width:12.35em;">
                      <span style="float:right">
                      @if(model.year2015.postTriggerDcAmount2015P2 != None) {
                        <tr style="text-align:left;min-width: 7em">
                            <p>@Messages("paac.post.trigger.amount.input.label")</p>
                            <span  class="form-hint">@Messages("paac.common.inputfield.example.message")</span>
                            &pound;&nbsp;<input type="number" name="@id" id="@id" min="0" class="input--no-spinner" value='@(model.year2015.postTriggerDcAmount2015P2.get)' max="5000000" size="7" style="width:9em;@if(paacForm.errors.find(_.key == id)) {border: 4px solid #b10e1e;}"/>
                        </tr>
                      } else {
                        <tr style="text-align:left;min-width: 7em">
                            <p>@Messages("paac.post.trigger.amount.input.label")</p>
                            <span  class="form-hint">@Messages("paac.common.inputfield.example.message")</span>
                            &pound;&nbsp;<input type="number" name="@id" id="@id" min="0" class="input--no-spinner" value='' max="5000000" size="7" style="width:9em;@if(paacForm.errors.find(_.key == id)) {border: 4px solid #b10e1e;}"/>
                        </tr>
                      }
                      </span>
                </fieldset>
                }
              }
              @if(!model.triggerDatePeriod.get.isPeriod1() && !model.triggerDatePeriod.get.isPeriod2()) {
                @defining("triggerAmount") { id =>
                <fieldset id="triggerAmountFieldset" class="form-field-group" style="max-width:12.35em;">
                      <span style="float:right">
                      @if(model.triggerAmount != None) {
                        <tr style="text-align:left;min-width: 7em">
                            <p>@Messages("paac.post.trigger.amount.input.label")</p>
                            <span  class="form-hint">@Messages("paac.common.inputfield.example.message")</span>
                            &pound;&nbsp;<input type="number" name="@id" id="@id" min="0" class="input--no-spinner" value='@(model.triggerAmount.get)' max="5000000" size="7" style="width:9em;@if(paacForm.errors.find(_.key == id)) {border: 4px solid #b10e1e;}"/>
                        </tr>
                      } else {
                        <tr style="text-align:left;min-width: 7em">
                            <p>@Messages("paac.post.trigger.amount.input.label")</p>
                            <span  class="form-hint">@Messages("paac.common.inputfield.example.message")</span>
                            &pound;&nbsp;<input type="number" name="@id" id="@id" min="0" class="input--no-spinner" value='' max="5000000" size="7" style="width:9em;@if(paacForm.errors.find(_.key == id)) {border: 4px solid #b10e1e;}"/>
                        </tr>
                      }
                      </span>
                </fieldset>
                }
              }
            </tbody>
          </table>
          }
        <button id="submit" type="submit" class="button" value="Continue">@if(isEdit){@Messages("paac.calculator.button.save")}else{@Messages("paac.calculator.button.continue")}</button>
    }
  }
}
}