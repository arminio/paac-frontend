@(reviewForm : Form[models.CalculatorFormFields], 
  hasBenefits: Boolean, 
  hasContributions: Boolean,
  hasTriggerDate: Boolean,
  triggerContribution: Option[Contribution])(implicit request:Request[_])

@import uk.gov.hmrc.play.views.html.helpers._
@import java.math.BigDecimal

@common.paacMain(
pageTitle = Messages("paac.review-amounts.page.heading"),
heading = Messages("paac.review-amounts.page.title"),
mainClass = "main",
articleClasses = Some("full-width"),
backLink = Some((controllers.routes.ReviewTotalAmountsController.onBack.url,Messages("paac.link.text.back")))
) {

@if(reviewForm.hasErrors) {
<div class="error-summary" role="group" aria-labelledby="error-summary-heading-example-1" tabindex="-1"
     style="border: 5px solid #b10e1e;padding: 20px;padding-top: 0px;margin-bottom: 30px;">

    <h1 class="heading-medium error-summary-heading">
        There was a problem with the amounts you reported to us
    </h1>

    @if(reviewForm.hasGlobalErrors) {
    <ul>
        @for(error <- reviewForm.globalErrors) {
        <li>@error.message</li>
        }
    </ul>
    }

    <ul class="error-summary-list">
        @for(error <- reviewForm.errors) {
        @defining(Seq(error.key)++error.args) { args =>
        <li><a href="#" style="color:#b10e1e;font-weight: bold;">@Messages(error.message, args:_*)</a></li>
        }
        }
    </ul>
</div>
}

@if(reviewForm.hasErrors == false && reviewForm.hasGlobalErrors == false) {
<table>
    <thead>
    <tr>
        <th class="numeric" scope="col">@Messages("paac.review-amounts.heading.period")</th>
        @if(hasContributions) {
        <th class="numeric" scope="col">@Messages("paac.review-amounts.heading.mp")</th>
        }
        @if(hasBenefits) {
        <th class="numeric" scope="col">@Messages("paac.review-amounts.heading.db")</th>
        }
        @if(triggerContribution.isDefined) {
        <th class="numeric" scope="col">@Messages("paac.review-amounts.heading.trigger.savings")</th>
        <th class="numeric" scope="col">@Messages("paac.review-amounts.heading.trigger.date")</th>
        }
        <th class="edit_action" scope="col"></th>
    </tr>
    </thead>
    <tbody>
    @defining(java.text.NumberFormat.getNumberInstance(java.util.Locale.UK)) { currencyFormatter =>
    @for(contribution <- (if (triggerContribution.isDefined) reviewForm.get.toPageValues.reverse.filterNot((c1)=>c1==triggerContribution.get) else reviewForm.get.toPageValues.reverse)) {
        @defining(contribution.amounts.getOrElse(InputAmounts())) { amounts =>
        @if(contribution.isEmpty() == false) {
        <tr>
            <td class="numeric">@(contribution.taxYearLabel())</td>
            @if(hasContributions) {
            <td class="numeric">
                @if(amounts.moneyPurchase.isDefined){
                &pound;@(currencyFormatter.format(amounts.moneyPurchase.get/100D))
                } else {
                &pound;&nbsp;&ndash;
                }
            </td>
            }
            @if(hasBenefits) {
            <td class="numeric">
                @if(amounts.definedBenefit.isDefined) {
                    &pound;@(currencyFormatter.format(amounts.definedBenefit.get/100D))
                } else {
                    &pound;&nbsp;&ndash;
                }
            </td>
            }
            @if(triggerContribution.isDefined) {
            @if(triggerContribution.get.isPeriod1 && contribution.isPeriod1 || triggerContribution.get.isPeriod2 && contribution.isPeriod2) {
            <td class="numeric">
            @defining(triggerContribution.get.amounts.getOrElse(InputAmounts())) { amounts2 =>
            &pound;@(currencyFormatter.format(amounts2.moneyPurchase.get/100D))
            }
            </td>
            <td class="numeric">
            @defining(reviewForm.get.triggerDate.get.split("-")) { dateParts =>
            @(dateParts(2))-@(dateParts(1))-@(dateParts(0))
            }
            </td>
            } else {
            <td class="numeric"></td>
            <td class="numeric"></td>
            }
            }
            <td class="edit_action">
                @if(contribution.taxPeriodStart.year < 2015) {
                <a href="edit/@contribution.taxPeriodStart.year">
                }
                @if(contribution.isPeriod1()) {
                <a href="edit/20151">
                }
                @if(contribution.isPeriod2()) {
                <a href="edit/20152">
                }
                 @Messages("paac.review-amounts.action.edit") <span class="visuallyhidden">@(contribution.taxYearLabel())</span>
                </a>
            </td>
        </tr>
        }
        }
    }
    }
    </tbody>
</table>
}
@form(
action = controllers.routes.ReviewTotalAmountsController.onSubmit,
args = 'class -> "form", 'autocomplete -> "off", 'novalidate -> "") {
<button id="submit" type="submit" class="button" value="Continue">@Messages("paac.review-amounts.button.continue")
</button>
} @* End of form *@
} @* End of common.paacMain *@
