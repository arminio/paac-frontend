@(reviewForm : Form[models.CalculatorFormFields])(implicit request:Request[_])

@import uk.gov.hmrc.play.views.html.helpers._
@import java.math.BigDecimal

@common.paacMain(
pageTitle = Messages("paac.review-amounts.page.heading"),
heading = Messages("paac.review-amounts.page.title"),
mainClass = "main",
articleClasses = Some("full-width"),
backLink = Some((controllers.routes.ReviewTotalAmountsController.onBack.url,Messages("paac.link.text.back")))
) {

@if(reviewForm.hasErrors) {
<div class="error-summary" role="group" aria-labelledby="error-summary-heading-example-1" tabindex="-1"
     style="border: 5px solid #b10e1e;padding: 20px;padding-top: 0px;margin-bottom: 30px;">

    <h1 class="heading-medium error-summary-heading">
        There was a problem with the amounts you reported to us
    </h1>

    @if(reviewForm.hasGlobalErrors) {
    <ul>
        @for(error <- reviewForm.globalErrors) {
        <li>@error.message</li>
        }
    </ul>
    }

    <ul class="error-summary-list">
        @for(error <- reviewForm.errors) {
        @defining(Seq(error.key)++error.args) { args =>
        <li><a href="#" style="color:#b10e1e;font-weight: bold;">@Messages(error.message, args:_*)</a></li>
        }
        }
    </ul>
</div>
}

@if(reviewForm.hasErrors == false && reviewForm.hasGlobalErrors == false) {
  @defining(java.text.NumberFormat.getNumberInstance(java.util.Locale.UK)) { currencyFormatter =>
  @defining(reviewForm.get.toPageValues.reverse.find(_.isTriggered)) { triggerContribution => 
  
    @for(contribution <- (if (triggerContribution.isDefined) reviewForm.get.toPageValues.reverse.filterNot((c1)=>c1==triggerContribution.get||c1.isEmpty) else reviewForm.get.toPageValues.reverse.filterNot(_.isEmpty))) {
    <table id="@(contribution.taxPeriodStart.year)">
    <thead>
    <tr>
        <th scope="50%">
        @if(contribution.isPeriod1) {
            @Messages("paac.review-amounts.heading.period",contribution.taxPeriodStart.year.toString(), (contribution.taxPeriodStart.year+1).toString(), 1)
        }
        @if(contribution.isPeriod2) {
            @Messages("paac.review-amounts.heading.period",contribution.taxPeriodStart.year.toString(), (contribution.taxPeriodStart.year+1).toString(), 2)
        }
        @if(!contribution.isPeriod1 && !contribution.isPeriod2) {
            @Messages("paac.review-amounts.heading",contribution.taxPeriodStart.year.toString(), (contribution.taxPeriodStart.year+1).toString())
        }
        </th>
        <th width="35%"></th>
        <th class="edit_action" width="15%"></th>
    </tr>
    </thead>
    <tbody>
        @defining(contribution.amounts.getOrElse(InputAmounts())) { amounts =>
        @if(amounts.moneyPurchase.isDefined && contribution.taxPeriodStart.year >= 2015){
        <tr>
            <td>@Messages("paac.review-amounts.heading.mp")</td>
            <td class="numeric">&pound;@(currencyFormatter.format(amounts.moneyPurchase.get/100D))</td>
            <td class="edit_action">
                @if(contribution.taxPeriodStart.year < 2015) {
                <a href="edit/@contribution.taxPeriodStart.year">
                }
                @if(contribution.isPeriod1()) {
                <a href="edit/20151">
                }
                @if(contribution.isPeriod2()) {
                <a href="edit/20152">
                }
                 @Messages("paac.review-amounts.action.edit") <span class="visuallyhidden">@(contribution.taxYearLabel())</span>
                </a>
            </td>
        </tr>
        }        
        @if(amounts.definedBenefit.isDefined){
        <tr>
            <td>@if(contribution.taxPeriodStart.year < 2015) { 
                    @Messages("paac.review-amounts.heading.total") 
                } else { 
                    @Messages("paac.review-amounts.heading.db") 
                }</td>
            <td class="numeric">&pound;@(currencyFormatter.format(amounts.definedBenefit.get/100D))</td>
            <td class="edit_action">
                @if(contribution.taxPeriodStart.year < 2015) {
                <a href="edit/@contribution.taxPeriodStart.year">
                }
                @if(contribution.isPeriod1()) {
                <a href="edit/20151">
                }
                @if(contribution.isPeriod2()) {
                <a href="edit/20152">
                }
                 @Messages("paac.review-amounts.action.edit") <span class="visuallyhidden">@(contribution.taxYearLabel())</span>
                </a>
            </td>
        </tr>
        }
        @if(triggerContribution.isDefined) {
        @if(triggerContribution.get.isPeriod1 && contribution.isPeriod1 || 
            triggerContribution.get.isPeriod2 && contribution.isPeriod2 || 
            triggerContribution.get.taxPeriodEnd == contribution.taxPeriodEnd) {
        <tr>
            <td>@Messages("paac.review-amounts.heading.trigger.date")</td>
            <td class="numeric">
            @defining(reviewForm.get.triggerDate.getOrElse("2000-1-1").split("-")) { dateParts =>
            @Messages("paac.review-amounts.value."+dateParts(1), dateParts(2).toInt.toString, dateParts(0))
            }
            </td>
            <td class="edit_action">
                <a href="edit/@(controllers.ReviewTotalAmountsController.EDIT_TRIGGER_DATE)">
                 @Messages("paac.review-amounts.action.edit") <span class="visuallyhidden">@(contribution.taxYearLabel())</span>
                </a>
            </td>
        </tr>
        <tr>
            <td>@Messages("paac.review-amounts.heading.trigger.savings", contribution.taxPeriodStart.year.toString(), (contribution.taxPeriodEnd.year+1).toString())</td>
            <td class="numeric">&pound;@(currencyFormatter.format(triggerContribution.get.amounts.getOrElse(InputAmounts()).moneyPurchase.get/100D))</td>
            <td class="edit_action">
                <a href="edit/@(controllers.ReviewTotalAmountsController.EDIT_TRIGGER_AMOUNT)">
                 @Messages("paac.review-amounts.action.edit") <span class="visuallyhidden">@(contribution.taxYearLabel())</span>
                </a>
            </td>
        </tr>
        }
        }












<!--
        <tr>
            <td class="numeric">@(contribution.taxYearLabel())</td>
            <td class="numeric">
                @if(amounts.moneyPurchase.isDefined){
                &pound;@(currencyFormatter.format(amounts.moneyPurchase.get/100D))
                } else {
                &pound;&nbsp;&ndash;
                }
            </td>
            <td class="numeric">
                @if(amounts.definedBenefit.isDefined) {
                    &pound;@(currencyFormatter.format(amounts.definedBenefit.get/100D))
                } else {
                    &pound;&nbsp;&ndash;
                }
            </td>
            @if(triggerContribution.isDefined) {
            @if(triggerContribution.get.isPeriod1 && contribution.isPeriod1 || triggerContribution.get.isPeriod2 && contribution.isPeriod2) {
            <td class="numeric">
            @defining(triggerContribution.get.amounts.getOrElse(InputAmounts())) { amounts2 =>
            &pound;@(currencyFormatter.format(amounts2.moneyPurchase.get/100D))
            }
            </td>
            <td class="numeric">
            @defining(reviewForm.get.triggerDate.get.split("-")) { dateParts =>
            @(dateParts(2))-@(dateParts(1))-@(dateParts(0))
            }
            </td>
            } else {
            <td class="numeric"></td>
            <td class="numeric"></td>
            }
        </tr>
-->
        }

    </tbody>
</table>
      }
    }
  }
  }
}
@form(
action = controllers.routes.ReviewTotalAmountsController.onSubmit,
args = 'class -> "form", 'autocomplete -> "off", 'novalidate -> "") {
<button id="submit" type="submit" class="button" value="Continue">@Messages("paac.review-amounts.button.continue")
</button>
} @* End of form *@
} @* End of common.paacMain *@
