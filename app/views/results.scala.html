@(results: List[models.TaxYearResults], selectedYears: Array[Int])(implicit request:Request[_])

@common.paacMain(
pageTitle = Messages("paac.results.page.title"),
heading = Messages("paac.results.page.heading"),
mainClass = "main",
articleClasses=Some("full-width"),
backLink = Some((controllers.routes.ReviewTotalAmountsController.onPageLoad.url,Messages("paac.link.text.back")))
) {
@defining(java.text.NumberFormat.getNumberInstance(java.util.Locale.UK)) { currencyFormatter =>
@defining(results.sortWith(_.input.taxPeriodStart.year < _.input.taxPeriodStart.year).dropWhile((v)=>v.input.isEmpty).reverse.filter((c)=>selectedYears.contains(c.input.taxPeriodStart.year))) { sortedResults =>
  <p class="govuk-box-highlight lede">@Html(Messages("paac.results.p1", if (sortedResults.exists((r)=>r.input.isPeriod1||r.input.isPeriod2)) sortedResults.size - 1 else sortedResults.size, currencyFormatter.format(sortedResults.map(_.summaryResult.chargableAmount).foldLeft(0L)(_+_)/100)))</p>
    <table>
       <thead>
       <tr>
         <th scope="col">@Html(Messages("paac.results.table.col.1"))</th>
         <th class="numeric" scope="col">@Html(Messages("paac.results.table.col.2"))</th>
         <th class="numeric" scope="col">@Html(Messages("paac.results.table.col.3"))</th>
         <th class="numeric" scope="col">@Html(Messages("paac.results.table.col.4"))</th>
         <th class="numeric" scope="col">@Html(Messages("paac.results.table.col.5"))</th>
         <th class="numeric" scope="col">@Html(Messages("paac.results.table.col.6"))</th>
       </tr>
       </thead>
       <tbody>

    @sortedResults.map { result =>
      @if(result.input.amounts.isDefined && !result.input.isPeriod1 && !result.input.isPeriod2) {
       <tr>
          <td>@Messages("paac.results.taxyearlabel", result.input.taxPeriodStart.year.toString, (result.input.taxPeriodStart.year+1).toString)</td>
          <td class="numeric">
            @if(result.summaryResult.alternativeAA > 0) {
              &pound;@(currencyFormatter.format(result.summaryResult.alternativeAA/100))</td>
            } else {
              &pound;@(currencyFormatter.format(result.summaryResult.availableAllowance/100))</td>
            }
          </td>
          <td class="numeric">@if(result.summaryResult.moneyPurchaseAA>0){&pound;@(currencyFormatter.format(result.summaryResult.moneyPurchaseAA/100))}</td>
          <td class="numeric">&pound;@(currencyFormatter.format((result.input.amounts.get.definedBenefit.getOrElse(0L) + result.input.amounts.get.moneyPurchase.getOrElse(0L))/100))</td>
          <td class="numeric">&pound;@(currencyFormatter.format(result.summaryResult.chargableAmount/100))</td>
          <td class="numeric">&pound;@if(result.summaryResult.isMPA){@(currencyFormatter.format(result.summaryResult.unusedAAA/100))} else {@(currencyFormatter.format(result.summaryResult.unusedAllowance/100))}</td>
          <!--td class="numeric">&pound;@(currencyFormatter.format(result.summaryResult.unusedMPAA/100))</td>
          <td class="numeric">&pound;@(currencyFormatter.format(result.summaryResult.unusedAAA/100))</td-->
       </tr>
      }
      @if(result.input.amounts.isDefined && result.input.isPeriod1) {
       <tr>
          <td>@Messages("paac.results.taxyearlabel.p1")</td>
          <td class="numeric">
            @if(result.summaryResult.alternativeAA > 0) {
              &pound;@(currencyFormatter.format(result.summaryResult.alternativeAA/100))</td>
            } else {
              &pound;@(currencyFormatter.format(result.summaryResult.availableAllowance/100))</td>
            }
          </td>
          <td class="numeric">@if(result.summaryResult.moneyPurchaseAA>0){&pound;@(currencyFormatter.format(result.summaryResult.moneyPurchaseAA/100))}</td>
          <td class="numeric">&pound;@(currencyFormatter.format((result.input.amounts.get.definedBenefit.getOrElse(0L) + 
                                                                result.input.amounts.get.moneyPurchase.getOrElse(0L))
                                                                /100))</td>
          <td class="numeric">&pound;@(currencyFormatter.format((result.summaryResult.chargableAmount)/100))</td>
          <td class="numeric">&pound;@(currencyFormatter.format(result.summaryResult.unusedAAA.max(result.summaryResult.unusedAllowance)/100))</td>
          <!--td class="numeric">&pound;@(currencyFormatter.format(result.summaryResult.unusedMPAA/100))</td>
          <td class="numeric">&pound;@(currencyFormatter.format(result.summaryResult.unusedAAA/100))</td-->
       </tr>
      }
      @if(result.input.amounts.isDefined && result.input.isPeriod2) {
       <tr>
          <td>@Messages("paac.results.taxyearlabel.p2")</td>
          <td class="numeric">
            @if(result.summaryResult.alternativeAA > 0) {
              &pound;@(currencyFormatter.format(result.summaryResult.alternativeAA/100))</td>
            } else {
              &pound;@(currencyFormatter.format(result.summaryResult.availableAllowance/100))</td>
            }
          </td>
          <td class="numeric">@if(result.summaryResult.moneyPurchaseAA>0){&pound;@(currencyFormatter.format(result.summaryResult.moneyPurchaseAA/100))}</td>
          <td class="numeric">&pound;@(currencyFormatter.format((result.input.amounts.get.definedBenefit.getOrElse(0L) + 
                                                                result.input.amounts.get.moneyPurchase.getOrElse(0L))/100))</td>
          <td class="numeric">&pound;@(currencyFormatter.format((result.summaryResult.chargableAmount)/100))</td>
          <td class="numeric">&pound;@(currencyFormatter.format(result.summaryResult.unusedAAA.max(result.summaryResult.unusedAllowance)/100))</td>
          <!--td class="numeric">&pound;@(currencyFormatter.format(result.summaryResult.unusedMPAA/100))</td>
          <td class="numeric">&pound;@(currencyFormatter.format(result.summaryResult.unusedAAA/100))</td-->
       </tr>
      }
    }
       </tbody>
      </table>
}
}
  <div class="panel panel-indent">
    <p>
      You can use these figures to complete your Self Assessment tax return online.
    </p>
  </div>
  <a class="button" href="new" style="margin-top:50px;">@Messages("paac.results.link.new")</a>
}